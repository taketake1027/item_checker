<div class="container mt-4">
  <h1 class="text-center mb-4">新規アイテム追加</h1>

  <%= form_with(model: @item, url: admin_items_path, local: true, html: { multipart: true, id: 'item-form' }) do |form| %>
    <% if @item.errors.any? %>
      <div class="alert alert-danger">
        <ul>
          <% @item.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <!-- アイテム名 -->
    <div class="form-group mb-3">
      <%= form.label :name, 'アイテム名' %>
      <%= form.text_field :name, class: 'form-control' %>
    </div>

    <!-- アイテム説明 -->
    <div class="form-group mb-3">
      <%= form.label :introduction, 'アイテム説明' %>
      <%= form.text_area :introduction, class: 'form-control' %>
    </div>

    <!-- 準備状態 -->
    <div class="form-group mb-3">
      <%= form.label :status, '準備状態' %>
      <%= form.select :status, options_for_select(['完了', '未完了'], @item.status), class: 'form-control', id: 'status-select' %>
    </div>

    <!-- 必要数量 -->
    <div class="form-group mb-3" id="amount-field">
      <%= form.label :amount, '必要数量' %>
      <%= form.number_field :amount, class: 'form-control' %>
    </div>

    <!-- 準備済み数量 -->
    <div class="form-group mb-3" id="prepared-amount-field">
      <%= form.label :prepared_amount, '準備済み数量' %>
      <%= form.number_field :prepared_amount, class: 'form-control' %>
    </div>

    <!-- イベント -->
    <div class="form-group mb-3">
      <%= form.label :event_id, 'イベント' %>
      <%= form.collection_select :event_id, Event.all, :id, :name, prompt: 'イベントを選択', class: 'form-control' %>
    </div>

    <!-- アイテム画像 -->
    <div class="form-group mb-3">
      <%= form.label :image, 'アイテム画像' %>
      <%= form.file_field :image, class: 'form-control' %>
    </div>

    <!-- アイテム作成ボタン -->
    <div class="text-center">
      <%= form.submit 'アイテムを作成', class: 'btn btn-primary' %>
    </div>
  <% end %>

  <!-- 戻るボタン -->
  <div class="text-center mt-3">
    <%= link_to 'アイテム一覧に戻る', admin_items_path, class: 'btn btn-secondary' %>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const statusSelect = document.getElementById('status-select');
    const amountField = document.getElementById('amount-field');
    const preparedAmountField = document.getElementById('prepared-amount-field');

    function toggleFields() {
      if (statusSelect.value === '完了') {
        amountField.style.display = 'none'; // 必要数量を非表示
        preparedAmountField.style.display = 'none'; // 準備済み数量を非表示
        // フィールドの値をクリア
        const amountInput = amountField.querySelector('input');
        const preparedAmountInput = preparedAmountField.querySelector('input');
        if (amountInput) amountInput.value = '';
        if (preparedAmountInput) preparedAmountInput.value = '';
      } else {
        amountField.style.display = 'block'; // 必要数量を表示
        preparedAmountField.style.display = 'block'; // 準備済み数量を表示
      }
    }

    // 初期表示を切り替え
    toggleFields();

    // 状態変更時に切り替え
    statusSelect.addEventListener('change', toggleFields);
  });
</script>
